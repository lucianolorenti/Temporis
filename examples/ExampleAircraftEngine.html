<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting Started &mdash; Temporis  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Target transformation" href="../reference/feature_transformation/target.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Temporis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Installation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/installation.html">Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/installation.html#installation">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Dataset:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/dataset.html">Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/iterators.html">Dataset iterators</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Feature Transformation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/feature_transformation/index.html">Feature Transformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/feature_transformation/transformer.html">Transformer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/feature_transformation/pipeline.html">Transformer pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/feature_transformation/step.html">Feature transformation step</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/feature_transformation/transformations.html">Transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/feature_transformation/target.html">Target transformation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting started:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Import">Import</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Dataset">Dataset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Number-of-lives-in-the-training-set">Number of lives in the training set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Number-of-lives-in-the-validation-set">Number of lives in the validation set</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Visualization">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Dataset-analysis">Dataset analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Missing-values">Missing values</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Variance">Variance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Transformers">Transformers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Functional-API">Functional API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Scikit-learn-API">Scikit-learn API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Fitting-the-transformer">Fitting the transformer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Transforming-a-life">Transforming a life</a></li>
<li class="toctree-l3"><a class="reference internal" href="#More-complex-transformers">More complex transformers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Iterators">Iterators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Lives-iterator">Lives iterator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#WindowedDatasetIterator">WindowedDatasetIterator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Batcher">Batcher</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#How-dos-a-sample-looks-like?">How dos a sample looks like?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Model">Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Keras-models">Keras models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Saving-the-model">Saving the model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Loading-the-model">Loading the model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Learning-curves">Learning curves</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Prediction-on-the-training-set">Prediction on the training set</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Prediction-on-the-validation-set">Prediction on the validation set</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#A-more-complex-model">A more complex model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#A-custom-model">A custom model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Scikit-learn-and-gradient-boosting-models">Scikit-learn and gradient boosting models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Model-comparison-and-evaluation">Model comparison and evaluation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Bar-Plot">Bar Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Box-Plot">Box Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Comparison-with-baseline-models">Comparison with baseline models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Baseline-models-creation">Baseline models creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Fitting-baseline-models">Fitting baseline models</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Comparison-with-the-full-set-of-models">Comparison with the full set of models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Regression-metrics">Regression metrics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Maintenance-metrics">Maintenance metrics</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Temporis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Getting Started</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/ExampleAircraftEngine.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Getting-Started">
<h1>Getting Started<a class="headerlink" href="#Getting-Started" title="Permalink to this headline"></a></h1>
<p>This guide will make use of the dataset generated with the Commercial Modular Aero-Propulsion System Simulation (C-MAPSS) dynamical model. The dataset consists of multiple multivariate time series. Each data set is further divided into training and test subsets. Each time series is from a different engine - i.e., the data can be considered to be from a fleet of engines of the same type. Each engine starts with different degrees of initial wear and manufacturing variation which is unknown to the
user. This wear and variation are considered normal, i.e., it is not considered a fault condition. There are three operational settings that have a substantial effect on engine performance. These settings are also included in the data. The data are contaminated with sensor noise.</p>
<p>The engine is operating normally at the start of each time series and starts to degrade at some point during the series. In the training set, the degradation grows in magnitude until a predefined threshold is reached beyond which it is not preferable to operate the engine. In the test set, the time series ends some time prior to complete degradation. The objective of the competition is to predict the number of operational cycles after the last cycle that the engine will continue to operate
properly.</p>
<p>The data are provided as a zip-compressed text file with 26 columns of numbers, separated by spaces. Each row is a snapshot of data taken during a single operational cycle; each column is a different variable.</p>
<p>Dataset structure</p>
<ul class="simple">
<li><p>Unit: Engine number [-]</p></li>
<li><p>t: time [cycles]</p></li>
<li><p>0p1: operational setting 1</p></li>
<li><p>op2: operational setting 2</p></li>
<li><p>op3: operational setting 3</p></li>
<li><p>s1: Sensor measurement 1</p></li>
<li><p>s2: Sensor measurement 2 …</p></li>
<li><p>s20: sensor measurement 20</p></li>
</ul>
<p>In the first set of data, there are 100 train trajectories and 100 test trajectories.</p>
<p>[1] A. Saxena, M. Ieee, K. Goebel, D. Simon, and N. Eklund, “Damage Propagation Modeling for Aircraft Engine Prognostics,” Response, 2008.</p>
<section id="Import">
<h2>Import<a class="headerlink" href="#Import" title="Permalink to this headline"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">RobustScaler</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">ReduceLROnPlateau</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">rul_pm.dataset.analysis</span> <span class="kn">import</span> <span class="p">(</span><span class="n">null_proportion</span><span class="p">,</span> <span class="n">null_proportion_per_life</span><span class="p">,</span>
                                     <span class="n">variance_information</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">rul_pm.dataset.CMAPSS</span> <span class="kn">import</span> <span class="p">(</span><span class="n">engines</span><span class="p">,</span> <span class="n">operation_mode</span><span class="p">,</span> <span class="n">process_file_test</span><span class="p">,</span>
                                   <span class="n">process_file_train</span><span class="p">,</span> <span class="n">sensor_indices</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">rul_pm.dataset.lives_dataset</span> <span class="kn">import</span> <span class="n">AbstractLivesDataset</span>
<span class="kn">from</span> <span class="nn">rul_pm.graphics.duration</span> <span class="kn">import</span> <span class="p">(</span><span class="n">add_vertical_line</span><span class="p">,</span> <span class="n">durations_boxplot</span><span class="p">,</span>
                                      <span class="n">lives_duration_histogram</span><span class="p">,</span>
                                      <span class="n">lives_duration_histogram_from_durations</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">rul_pm.graphics.plots</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">hold_out_barplot_errors_wrt_RUL_multiple_models</span><span class="p">,</span>
    <span class="n">hold_out_boxplot_errors_wrt_RUL_multiple_models</span><span class="p">,</span> <span class="n">plot_life</span><span class="p">,</span>
    <span class="n">plot_true_and_predicted</span><span class="p">,</span> <span class="n">plot_unexpected_breaks</span><span class="p">,</span> <span class="n">plot_unexploited_lifetime</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">rul_pm.iterators.batcher</span> <span class="kn">import</span> <span class="n">Batcher</span>
<span class="kn">from</span> <span class="nn">rul_pm.iterators.iterators</span> <span class="kn">import</span> <span class="p">(</span><span class="n">LifeDatasetIterator</span><span class="p">,</span>
                                        <span class="n">WindowedDatasetIterator</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">rul_pm.iterators.utils</span> <span class="kn">import</span> <span class="n">true_values</span>
<span class="kn">from</span> <span class="nn">rul_pm.models.baseline</span> <span class="kn">import</span> <span class="n">BaselineModel</span>
<span class="kn">from</span> <span class="nn">rul_pm.models.keras.models.simple</span> <span class="kn">import</span> <span class="n">FCN</span>
<span class="kn">from</span> <span class="nn">rul_pm.models.keras.models.XiangQiangJianQiao</span> <span class="kn">import</span> \
    <span class="n">XiangQiangJianQiaoModel</span>
<span class="kn">from</span> <span class="nn">rul_pm.models.sklearn</span> <span class="kn">import</span> <span class="n">SKLearnModel</span>
<span class="kn">from</span> <span class="nn">rul_pm.results.results</span> <span class="kn">import</span> <span class="n">split_lives</span><span class="p">,</span> <span class="n">cv_regression_metrics</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.features.extraction</span> <span class="kn">import</span> <span class="n">RollingStatisticsPandas</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.features.imputers</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ForwardFillImputer</span><span class="p">,</span>
                                                     <span class="n">PandasMeanImputer</span><span class="p">,</span>
                                                     <span class="n">PandasRemoveInf</span><span class="p">,</span>
                                                     <span class="n">PerColumnImputer</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.features.outliers</span> <span class="kn">import</span> <span class="p">(</span><span class="n">IQROutlierRemover</span><span class="p">,</span>
                                                     <span class="n">ZScoreOutlierRemover</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.features.resamplers</span> <span class="kn">import</span> <span class="n">ResamplerTransformer</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.features.scalers</span> <span class="kn">import</span> <span class="n">PandasMinMaxScaler</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.features.selection</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ByNameFeatureSelector</span><span class="p">,</span> <span class="n">PandasNullProportionSelector</span><span class="p">,</span>
    <span class="n">PandasVarianceThreshold</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.pipeline</span> <span class="kn">import</span> <span class="n">LivesPipeline</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.target</span> <span class="kn">import</span> <span class="n">PicewiseRUL</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.transformers</span> <span class="kn">import</span> <span class="n">Transformer</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.transformerstep</span> <span class="kn">import</span> <span class="n">Concatenate</span>
<span class="kn">from</span> <span class="nn">rul_pm.transformation.utils</span> <span class="kn">import</span> <span class="p">(</span><span class="n">IdentityTransformer</span><span class="p">,</span>
                                         <span class="n">PandasTransformerWrapper</span><span class="p">)</span>

</pre></div>
</div>
</div>
</section>
<section id="Dataset">
<h2>Dataset<a class="headerlink" href="#Dataset" title="Permalink to this headline"></a></h2>
<p>The Dataset comes in a space separated tabular file. The functions <code class="docutils literal notranslate"><span class="pre">process_file_train</span></code> and <code class="docutils literal notranslate"><span class="pre">process_file_test</span></code> receive the filename of the dataset file and return a <code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code> with the pre-processed data. The <code class="docutils literal notranslate"><span class="pre">UnitNumber</span></code> column is a life identifier.</p>
<p>In order to define a dataset you should subclass <code class="docutils literal notranslate"><span class="pre">AbstractLivesDataset</span></code> and define three methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__getitem__(self,</span> <span class="pre">i)</span></code>: This method should return the i-th life</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nlives(self)</span></code>: In this method should return the total number of lives present in the dataset</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">CMAPSSDataset</span><span class="p">(</span><span class="n">AbstractLivesDataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">operation_mode</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Invalid model: valid model are </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">operation_mode</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">train</span><span class="p">:</span>
            <span class="n">processing_fun</span> <span class="o">=</span> <span class="n">process_file_train</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">processing_fun</span> <span class="o">=</span> <span class="n">process_file_test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lives</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">engine</span> <span class="ow">in</span> <span class="n">engines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">engine</span> <span class="o">!=</span> <span class="n">model</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">processing_fun</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;UnitNumber&#39;</span><span class="p">):</span>
                <span class="n">g</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;UnitNumber&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lives</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rul_column</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;RUL&#39;</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lives</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nlives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lives</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">CMAPSSDataset</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;FD001&#39;</span><span class="p">)</span>
<span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">CMAPSSDataset</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;FD001&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="Number-of-lives-in-the-training-set">
<h3>Number of lives in the training set<a class="headerlink" href="#Number-of-lives-in-the-training-set" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
100
</pre></div></div>
</div>
</section>
<section id="Number-of-lives-in-the-validation-set">
<h3>Number of lives in the validation set<a class="headerlink" href="#Number-of-lives-in-the-validation-set" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">len</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
100
</pre></div></div>
</div>
</section>
</section>
<section id="Visualization">
<h2>Visualization<a class="headerlink" href="#Visualization" title="Permalink to this headline"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">durations_boxplot</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Unit Cycles&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">durations_boxplot</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Validation&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Unit Cycles&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_13_0.png" src="../_images/examples_ExampleAircraftEngine_13_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">durations_boxplot</span><span class="p">([</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">validation_dataset</span><span class="p">],</span>
                  <span class="n">xlabel</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span> <span class="s1">&#39;Validation&#39;</span><span class="p">],</span>
                  <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Unit Cycles&#39;</span><span class="p">,</span>
                  <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_14_0.png" src="../_images/examples_ExampleAircraftEngine_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">lives_duration_histogram</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span>
                         <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Unit Cycles&#39;</span><span class="p">,</span>
                         <span class="n">units</span><span class="o">=</span><span class="s1">&#39;cycles&#39;</span><span class="p">,</span>
                         <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                         <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Train dataset&#39;</span><span class="p">)</span>
<span class="n">lives_duration_histogram</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span>
                         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation&#39;</span><span class="p">,</span>
                         <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Unit Cycles&#39;</span><span class="p">,</span>
                         <span class="n">units</span><span class="o">=</span><span class="s1">&#39;cycles&#39;</span><span class="p">,</span>
                         <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                         <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Validation dataset&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_15_0.png" src="../_images/examples_ExampleAircraftEngine_15_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lives_duration_histogram</span><span class="p">([</span><span class="n">train_dataset</span><span class="p">,</span><span class="n">validation_dataset</span><span class="p">],</span>
                         <span class="n">label</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Train&#39;</span><span class="p">,</span><span class="s1">&#39;Validation&#39;</span><span class="p">],</span>
                         <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Unit Cycles&#39;</span><span class="p">,</span>
                         <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                         <span class="n">units</span><span class="o">=</span><span class="s1">&#39;cycles&#39;</span><span class="p">,</span>
                         <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_16_0.png" src="../_images/examples_ExampleAircraftEngine_16_0.png" />
</div>
</div>
</section>
<section id="Dataset-analysis">
<h2>Dataset analysis<a class="headerlink" href="#Dataset-analysis" title="Permalink to this headline"></a></h2>
<section id="Missing-values">
<h3>Missing values<a class="headerlink" href="#Missing-values" title="Permalink to this headline"></a></h3>
<p>Usually, the information of sensors is incomplete and this causes numerous missing values in the features. This library provides some useful functions to analyse the proportion of the missing values for each feature for each life. In some cases, if the feature values are missing in multiple lives, that feature can be discarded.</p>
<p>Luckily in the NASA dataset, we don’t have any missing values:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">,</span> <span class="n">null_per_life</span> <span class="o">=</span> <span class="n">null_proportion</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feature</th>
      <th>Max Null Proportion</th>
      <th>Mean Null Proportion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>OpSet3</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>OpSet1</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>OpSet2</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>SensorMeasure12</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>SensorMeasure1</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>RUL</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>SensorMeasure10</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>OpMode</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Cycle</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>SensorMeasure20</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>SensorMeasure16</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>SensorMeasure3</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>SensorMeasure21</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SensorMeasure9</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SensorMeasure14</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SensorMeasure2</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>SensorMeasure19</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>SensorMeasure7</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>SensorMeasure11</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>SensorMeasure6</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>SensorMeasure5</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SensorMeasure18</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SensorMeasure4</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SensorMeasure13</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SensorMeasure17</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SensorMeasure8</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>SensorMeasure15</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">null_proportion_per_life</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Life</th>
      <th>Number of features</th>
      <th>Number of completely null features</th>
      <th>N of features with 50% null</th>
      <th>N of features with 25% null</th>
      <th>Mean null propotion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>63</th>
      <td>63</td>
      <td>27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>73</th>
      <td>73</td>
      <td>27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>72</th>
      <td>72</td>
      <td>27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>71</th>
      <td>71</td>
      <td>27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>30</th>
      <td>30</td>
      <td>27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>29</td>
      <td>27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>28</td>
      <td>27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>27</td>
      <td>27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>99</th>
      <td>99</td>
      <td>27</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>100 rows × 6 columns</p>
</div></div>
</div>
</section>
<section id="Variance">
<h3>Variance<a class="headerlink" href="#Variance" title="Permalink to this headline"></a></h3>
<p>Another possibility is that sensors do not vary equally in a diverse set of lives. Another function obtains information about the variance of each feature per each life. If a feature variance is zero in many lives, maybe it is a good idea to remove it.</p>
<p>In the NASA dataset, we can see that some of the features have a zero variance in some of the lives.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="p">,</span> <span class="n">var_per_life</span> <span class="o">=</span> <span class="n">variance_information</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feature</th>
      <th>Min std Proportion</th>
      <th>Mean std Proportion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>OpSet3</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>23</th>
      <td>SensorMeasure1</td>
      <td>0.000000</td>
      <td>2.280172e-15</td>
    </tr>
    <tr>
      <th>21</th>
      <td>SensorMeasure10</td>
      <td>0.000000</td>
      <td>2.203638e-16</td>
    </tr>
    <tr>
      <th>20</th>
      <td>OpMode</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>17</th>
      <td>SensorMeasure16</td>
      <td>0.000000</td>
      <td>5.321406e-18</td>
    </tr>
    <tr>
      <th>6</th>
      <td>SensorMeasure18</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>7</th>
      <td>SensorMeasure5</td>
      <td>0.000000</td>
      <td>1.264424e-15</td>
    </tr>
    <tr>
      <th>8</th>
      <td>SensorMeasure6</td>
      <td>0.000000</td>
      <td>9.590898e-04</td>
    </tr>
    <tr>
      <th>11</th>
      <td>SensorMeasure19</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>25</th>
      <td>OpSet2</td>
      <td>0.000269</td>
      <td>2.897551e-04</td>
    </tr>
    <tr>
      <th>14</th>
      <td>OpSet1</td>
      <td>0.001953</td>
      <td>2.186825e-03</td>
    </tr>
    <tr>
      <th>26</th>
      <td>SensorMeasure15</td>
      <td>0.027545</td>
      <td>3.446460e-02</td>
    </tr>
    <tr>
      <th>2</th>
      <td>SensorMeasure8</td>
      <td>0.028232</td>
      <td>5.659648e-02</td>
    </tr>
    <tr>
      <th>4</th>
      <td>SensorMeasure13</td>
      <td>0.031886</td>
      <td>5.727052e-02</td>
    </tr>
    <tr>
      <th>15</th>
      <td>SensorMeasure21</td>
      <td>0.078355</td>
      <td>9.955036e-02</td>
    </tr>
    <tr>
      <th>18</th>
      <td>SensorMeasure20</td>
      <td>0.136852</td>
      <td>1.664198e-01</td>
    </tr>
    <tr>
      <th>9</th>
      <td>SensorMeasure11</td>
      <td>0.174484</td>
      <td>2.374455e-01</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SensorMeasure2</td>
      <td>0.372103</td>
      <td>4.628500e-01</td>
    </tr>
    <tr>
      <th>24</th>
      <td>SensorMeasure12</td>
      <td>0.448932</td>
      <td>6.481781e-01</td>
    </tr>
    <tr>
      <th>10</th>
      <td>SensorMeasure7</td>
      <td>0.567381</td>
      <td>7.864672e-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>SensorMeasure17</td>
      <td>1.145231</td>
      <td>1.450997e+00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>SensorMeasure14</td>
      <td>2.920401</td>
      <td>1.180401e+01</td>
    </tr>
    <tr>
      <th>13</th>
      <td>SensorMeasure9</td>
      <td>3.845202</td>
      <td>1.418905e+01</td>
    </tr>
    <tr>
      <th>16</th>
      <td>SensorMeasure3</td>
      <td>4.589708</td>
      <td>5.788760e+00</td>
    </tr>
    <tr>
      <th>5</th>
      <td>SensorMeasure4</td>
      <td>6.281455</td>
      <td>8.118497e+00</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Cycle</td>
      <td>37.094474</td>
      <td>5.970072e+01</td>
    </tr>
    <tr>
      <th>22</th>
      <td>RUL</td>
      <td>37.094474</td>
      <td>5.970072e+01</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
<section id="Transformers">
<h2>Transformers<a class="headerlink" href="#Transformers" title="Permalink to this headline"></a></h2>
<p>There are two ways of defining a transformer. The first way is more similar to the scikit-learn Pipeline API, and the other one is similar to the tensorflow functional API. Two pipelines have to be defined: * How the data is going to be transformed * This transformer invovles selecting and transforming and generating features * How the target is going to be transformed * This transformer involves selecting and transforming the target</p>
<p>The base class of the pipeline is the <code class="docutils literal notranslate"><span class="pre">LivesPipeline</span></code> class. This class is an extension of <code class="docutils literal notranslate"><span class="pre">sklearn.pipeline.Pipeline</span></code> and change the way the data is fitted. Each transformer class inherit from the <code class="docutils literal notranslate"><span class="pre">TransformerStep</span></code>. This class implements the method <code class="docutils literal notranslate"><span class="pre">partial_fit</span></code> which receives the data belonging to the whole life and update its internal state accordingly.</p>
<section id="Functional-API">
<h3>Functional API<a class="headerlink" href="#Functional-API" title="Permalink to this headline"></a></h3>
<p>Following the literature, the future that addresses this dataset, only a subset of the feature are going to be used to fit our model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">train_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sensor_indices</span><span class="p">]</span>
<span class="n">features</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;SensorMeasure2&#39;,
 &#39;SensorMeasure3&#39;,
 &#39;SensorMeasure4&#39;,
 &#39;SensorMeasure7&#39;,
 &#39;SensorMeasure8&#39;,
 &#39;SensorMeasure9&#39;,
 &#39;SensorMeasure11&#39;,
 &#39;SensorMeasure12&#39;,
 &#39;SensorMeasure13&#39;,
 &#39;SensorMeasure14&#39;,
 &#39;SensorMeasure15&#39;,
 &#39;SensorMeasure17&#39;,
 &#39;SensorMeasure20&#39;,
 &#39;SensorMeasure21&#39;]
</pre></div></div>
</div>
<p>The transformation of the input data will be simple, a feature scaling between -1 and 1 and imputing any missing value or non finite.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">functional_pipe</span> <span class="o">=</span> <span class="n">ByNameFeatureSelector</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="n">functional_pipe</span> <span class="o">=</span> <span class="n">PandasMinMaxScaler</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">functional_pipe</span><span class="p">)</span>
<span class="n">functional_pipe</span> <span class="o">=</span> <span class="n">PandasMeanImputer</span><span class="p">()(</span><span class="n">functional_pipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>One common approach for handling PM problems is to downplay the early stages of the execution due to the fact that that is harder to detect indication of degradation at the beggining.</p>
<p>For this dataset, a piece-wise linear degradation model has been validated to be suitable and effective. In general, the engine unit works normally in the early age and degrades linearly afterwards. It is assumed to have a constant RUL label in the initial period. [1]</p>
<p>[1] Li, X., Ding, Q., &amp; Sun, J. Q. (2018). Remaining useful life estimation in prognostics using deep convolution neural networks. Reliability Engineering &amp; System Safety, 172, 1-11.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">target_pipe</span> <span class="o">=</span> <span class="n">ByNameFeatureSelector</span><span class="p">([</span><span class="s1">&#39;RUL&#39;</span><span class="p">])</span>
<span class="n">target_pipe</span> <span class="o">=</span> <span class="n">PicewiseRUL</span><span class="p">(</span><span class="mi">125</span><span class="p">)(</span><span class="n">target_pipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">functional_transformer</span> <span class="o">=</span> <span class="n">Transformer</span><span class="p">(</span>
    <span class="n">transformerX</span><span class="o">=</span><span class="n">functional_pipe</span><span class="o">.</span><span class="n">build</span><span class="p">(),</span>
    <span class="n">transformerY</span><span class="o">=</span><span class="n">target_pipe</span><span class="o">.</span><span class="n">build</span><span class="p">())</span>

</pre></div>
</div>
</div>
</section>
<section id="Scikit-learn-API">
<h3>Scikit-learn API<a class="headerlink" href="#Scikit-learn-API" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sklearn_pipe</span> <span class="o">=</span> <span class="n">Transformer</span><span class="p">(</span>
    <span class="n">transformerX</span><span class="o">=</span><span class="n">LivesPipeline</span><span class="p">(</span>
        <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;selection&#39;</span><span class="p">,</span> <span class="n">ByNameFeatureSelector</span><span class="p">(</span><span class="n">features</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">PandasMinMaxScaler</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">PandasMeanImputer</span><span class="p">())</span>
        <span class="p">]</span>
    <span class="p">),</span>
    <span class="n">transformerY</span><span class="o">=</span><span class="n">LivesPipeline</span><span class="p">(</span>
        <span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;select_RUL&#39;</span><span class="p">,</span> <span class="n">ByNameFeatureSelector</span><span class="p">([</span><span class="s1">&#39;RUL&#39;</span><span class="p">]))</span>
        <span class="p">]</span>
    <span class="p">)</span>

<span class="p">)</span>

<span class="n">sklearn_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;rul_pm.transformation.transformers.Transformer at 0x7f9f4bb2f940&gt;
</pre></div></div>
</div>
</section>
<section id="Fitting-the-transformer">
<h3>Fitting the transformer<a class="headerlink" href="#Fitting-the-transformer" title="Permalink to this headline"></a></h3>
<p>The transformer must be fitted on the dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">functional_transformer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;rul_pm.transformation.transformers.Transformer at 0x7f9f4bb76640&gt;
</pre></div></div>
</div>
</section>
<section id="Transforming-a-life">
<h3>Transforming a life<a class="headerlink" href="#Transforming-a-life" title="Permalink to this headline"></a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">functional_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(192, 14)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_40_0.png" src="../_images/examples_ExampleAircraftEngine_40_0.png" />
</div>
</div>
</section>
<section id="More-complex-transformers">
<h3>More complex transformers<a class="headerlink" href="#More-complex-transformers" title="Permalink to this headline"></a></h3>
<p>More complex transformers can also be constructed. For example, we may want to use the raw features but also extract some statistics from a subset of features. In this case, we are going to obtain the kurtosis and the peak coefficient using a rolling window for 3 features. There are a lot of different feature extraction and transformation steps that can be applied. I encourage you to check the documentation to discover more.</p>
<p>The number of features we are going to obtain at the end will be the 14 coming from the raw features and 6=2*3 coming for the two statistics computed from the selected subset of size 3.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">raw_pipe</span> <span class="o">=</span> <span class="n">ByNameFeatureSelector</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="n">raw_pipe</span> <span class="o">=</span> <span class="n">ForwardFillImputer</span><span class="p">()(</span><span class="n">functional_pipe</span><span class="p">)</span>
<span class="n">raw_pipe</span> <span class="o">=</span> <span class="n">PandasMinMaxScaler</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;raw_scaled&#39;</span><span class="p">)(</span><span class="n">functional_pipe</span><span class="p">)</span>

<span class="n">transformed_pipe</span> <span class="o">=</span> <span class="n">ByNameFeatureSelector</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
<span class="n">transformed_pipe</span> <span class="o">=</span> <span class="n">RollingStatisticsPandas</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">to_compute</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;kurtosis&#39;</span><span class="p">,</span> <span class="s1">&#39;peak&#39;</span><span class="p">])(</span><span class="n">transformed_pipe</span><span class="p">)</span>
<span class="n">transformed_pipe</span> <span class="o">=</span> <span class="n">PandasMeanImputer</span><span class="p">()(</span><span class="n">transformed_pipe</span><span class="p">)</span>
<span class="n">transformed_pipe</span> <span class="o">=</span> <span class="n">PandasMinMaxScaler</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">robust</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;transformed_scaled&#39;</span><span class="p">)(</span><span class="n">transformed_pipe</span><span class="p">)</span>


<span class="n">pipe</span> <span class="o">=</span> <span class="n">Concatenate</span><span class="p">()([</span><span class="n">raw_pipe</span><span class="p">,</span> <span class="n">transformed_pipe</span><span class="p">])</span>

<span class="n">target_pipe</span> <span class="o">=</span> <span class="n">ByNameFeatureSelector</span><span class="p">([</span><span class="s1">&#39;RUL&#39;</span><span class="p">])</span>

<span class="n">complex_transformer</span> <span class="o">=</span> <span class="n">Transformer</span><span class="p">(</span>
    <span class="n">transformerX</span><span class="o">=</span><span class="n">pipe</span><span class="o">.</span><span class="n">build</span><span class="p">(),</span>
    <span class="n">transformerY</span><span class="o">=</span><span class="n">target_pipe</span><span class="o">.</span><span class="n">build</span><span class="p">())</span>

<span class="n">complex_transformer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;rul_pm.transformation.transformers.Transformer at 0x7f9f4ba861c0&gt;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">complex_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>The number of features as expected is 20 features: 14 from the raw features and 6 from the extracted ones</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(192, 20)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_46_0.png" src="../_images/examples_ExampleAircraftEngine_46_0.png" />
</div>
</div>
<p>The name of the obtained features are computed from the step names and the selected features</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">complex_transformer</span><span class="o">.</span><span class="n">columns</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([&#39;raw_scaled_0_SensorMeasure2&#39;, &#39;raw_scaled_0_SensorMeasure3&#39;,
       &#39;raw_scaled_0_SensorMeasure4&#39;, &#39;raw_scaled_0_SensorMeasure7&#39;,
       &#39;raw_scaled_0_SensorMeasure8&#39;, &#39;raw_scaled_0_SensorMeasure9&#39;,
       &#39;raw_scaled_0_SensorMeasure11&#39;, &#39;raw_scaled_0_SensorMeasure12&#39;,
       &#39;raw_scaled_0_SensorMeasure13&#39;, &#39;raw_scaled_0_SensorMeasure14&#39;,
       &#39;raw_scaled_0_SensorMeasure15&#39;, &#39;raw_scaled_0_SensorMeasure17&#39;,
       &#39;raw_scaled_0_SensorMeasure20&#39;, &#39;raw_scaled_0_SensorMeasure21&#39;,
       &#39;transformed_scaled_1_SensorMeasure2_kurtosis&#39;,
       &#39;transformed_scaled_1_SensorMeasure2_peak&#39;,
       &#39;transformed_scaled_1_SensorMeasure3_kurtosis&#39;,
       &#39;transformed_scaled_1_SensorMeasure3_peak&#39;,
       &#39;transformed_scaled_1_SensorMeasure4_kurtosis&#39;,
       &#39;transformed_scaled_1_SensorMeasure4_peak&#39;], dtype=object)
</pre></div></div>
</div>
</section>
</section>
<section id="Iterators">
<h2>Iterators<a class="headerlink" href="#Iterators" title="Permalink to this headline"></a></h2>
<section id="Lives-iterator">
<h3>Lives iterator<a class="headerlink" href="#Lives-iterator" title="Permalink to this headline"></a></h3>
<p>The dataset can be iterated. Each element of the iteration is life in stored in <code class="docutils literal notranslate"><span class="pre">pd.DataFrame</span></code> which contains all the features</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;Cycle&#39;, &#39;OpSet1&#39;, &#39;OpSet2&#39;, &#39;OpSet3&#39;, &#39;SensorMeasure1&#39;,
       &#39;SensorMeasure2&#39;, &#39;SensorMeasure3&#39;, &#39;SensorMeasure4&#39;, &#39;SensorMeasure5&#39;,
       &#39;SensorMeasure6&#39;, &#39;SensorMeasure7&#39;, &#39;SensorMeasure8&#39;, &#39;SensorMeasure9&#39;,
       &#39;SensorMeasure10&#39;, &#39;SensorMeasure11&#39;, &#39;SensorMeasure12&#39;,
       &#39;SensorMeasure13&#39;, &#39;SensorMeasure14&#39;, &#39;SensorMeasure15&#39;,
       &#39;SensorMeasure16&#39;, &#39;SensorMeasure17&#39;, &#39;SensorMeasure18&#39;,
       &#39;SensorMeasure19&#39;, &#39;SensorMeasure20&#39;, &#39;SensorMeasure21&#39;, &#39;RUL&#39;,
       &#39;OpMode&#39;],
      dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="k">for</span> <span class="n">life</span> <span class="ow">in</span> <span class="n">train_dataset</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">life</span><span class="p">[</span><span class="s1">&#39;RUL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_52_0.png" src="../_images/examples_ExampleAircraftEngine_52_0.png" />
</div>
</div>
</section>
<section id="WindowedDatasetIterator">
<h3>WindowedDatasetIterator<a class="headerlink" href="#WindowedDatasetIterator" title="Permalink to this headline"></a></h3>
<p>The windowed dataset iterator provides a way of iterating the transformed dataset trough an sliding window. The sample for the i-th element, provides the (window-1) elements of the window. It also provides capabilities to shuffle in diverse ways the how the samples are delivered by the iterator.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">window</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">iterator</span> <span class="o">=</span> <span class="n">WindowedDatasetIterator</span><span class="p">(</span>
    <span class="n">train_dataset</span><span class="p">,</span>
    <span class="n">window</span><span class="p">,</span>
    <span class="n">functional_transformer</span><span class="p">,</span>
    <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">output_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sw</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Since we are using the functional_transformer that only has 14 feature and a window size of 7 samples. The output of one element of the iterator wil be a matrix ox size (7 x14)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(7, 14)
</pre></div></div>
</div>
</section>
</section>
<section id="Batcher">
<h2>Batcher<a class="headerlink" href="#Batcher" title="Permalink to this headline"></a></h2>
<p>The batcher class make use of the <code class="docutils literal notranslate"><span class="pre">WindowedDatasetIterator</span></code> to generate batches of samples.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">window</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">66</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">train_batcher</span> <span class="o">=</span> <span class="n">Batcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="n">step</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sw</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">train_batcher</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>As expected the shape of the input data of one batch is: * 66 due to the batch size * 25 because the lookback window size * 14 for the selected features in the transformer</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(66, 25, 14)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(66, 1, 1)
</pre></div></div>
</div>
<section id="How-dos-a-sample-looks-like?">
<h3>How dos a sample looks like?<a class="headerlink" href="#How-dos-a-sample-looks-like?" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">45</span><span class="p">,</span> <span class="p">:,</span> <span class="n">f</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Values of the features to predict the marked point in the lookback window&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RUL of the complete life&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">45</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Point to predict&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7f9f45f63cd0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_64_1.png" src="../_images/examples_ExampleAircraftEngine_64_1.png" />
</div>
</div>
</section>
</section>
<section id="Model">
<h2>Model<a class="headerlink" href="#Model" title="Permalink to this headline"></a></h2>
<section id="Keras-models">
<h3>Keras models<a class="headerlink" href="#Keras-models" title="Permalink to this headline"></a></h3>
<p>Let’s create a simple model in keras with some FC layers.</p>
<p>First of all we need to create two batchers for feeding the model.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">window</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">train_batcher</span> <span class="o">=</span> <span class="n">Batcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="n">step</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
                            <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">val_batcher</span> <span class="o">=</span> <span class="n">Batcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="n">step</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                            <span class="n">restart_at_end</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


</pre></div>
</div>
</div>
<p>A simple fully connected model is already implemented in the library. You can specify the number of layers and the hidden dimension</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">FCN</span><span class="p">([</span><span class="mi">512</span><span class="p">,</span> <span class="mi">256</span><span class="p">],</span>
            <span class="n">dropout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
            <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">,</span>
            <span class="n">batch_normalization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">l2</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_batcher</span><span class="p">,</span> <span class="n">val_batcher</span> <span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;sequential&#34;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
flatten (Flatten)            (None, 896)               0
_________________________________________________________________
dense (Dense)                (None, 512)               459264
_________________________________________________________________
dropout (Dropout)            (None, 512)               0
_________________________________________________________________
dense_1 (Dense)              (None, 256)               131328
_________________________________________________________________
dropout_1 (Dropout)          (None, 256)               0
_________________________________________________________________
dense_2 (Dense)              (None, 1)                 257
=================================================================
Total params: 590,849
Trainable params: 590,849
Non-trainable params: 0
_________________________________________________________________
Epoch 1/25
896/896 [==============================] - 5s 5ms/step - loss: 2006.3747 - root_mean_squared_error: 32.4019 - val_loss: 279.8618 - val_root_mean_squared_error: 13.4661
Epoch 2/25
896/896 [==============================] - 3s 3ms/step - loss: 315.8370 - root_mean_squared_error: 13.8837 - val_loss: 203.3457 - val_root_mean_squared_error: 11.3253
Epoch 3/25
896/896 [==============================] - 3s 3ms/step - loss: 254.8489 - root_mean_squared_error: 12.1517 - val_loss: 186.8130 - val_root_mean_squared_error: 10.6308
Epoch 4/25
896/896 [==============================] - 3s 3ms/step - loss: 237.5506 - root_mean_squared_error: 11.5401 - val_loss: 203.9461 - val_root_mean_squared_error: 11.3927
Epoch 5/25
896/896 [==============================] - 3s 3ms/step - loss: 226.8876 - root_mean_squared_error: 11.2629 - val_loss: 254.9414 - val_root_mean_squared_error: 12.8905
Epoch 6/25
896/896 [==============================] - 3s 3ms/step - loss: 226.7687 - root_mean_squared_error: 11.1630 - val_loss: 174.4671 - val_root_mean_squared_error: 10.2689
Epoch 7/25
896/896 [==============================] - 3s 3ms/step - loss: 214.9839 - root_mean_squared_error: 10.8935 - val_loss: 173.7239 - val_root_mean_squared_error: 10.0428
Epoch 8/25
896/896 [==============================] - 3s 3ms/step - loss: 209.2745 - root_mean_squared_error: 10.7760 - val_loss: 174.4238 - val_root_mean_squared_error: 10.2321
Epoch 9/25
896/896 [==============================] - 3s 3ms/step - loss: 209.5833 - root_mean_squared_error: 10.7386 - val_loss: 188.1206 - val_root_mean_squared_error: 10.3699
Epoch 10/25
896/896 [==============================] - 3s 3ms/step - loss: 211.7311 - root_mean_squared_error: 10.7412 - val_loss: 172.2186 - val_root_mean_squared_error: 10.1281
Epoch 11/25
896/896 [==============================] - 3s 3ms/step - loss: 208.7907 - root_mean_squared_error: 10.6209 - val_loss: 171.7873 - val_root_mean_squared_error: 10.1349
Epoch 12/25
896/896 [==============================] - 3s 3ms/step - loss: 204.2922 - root_mean_squared_error: 10.5100 - val_loss: 170.5950 - val_root_mean_squared_error: 10.0852
Epoch 13/25
896/896 [==============================] - 3s 3ms/step - loss: 207.5224 - root_mean_squared_error: 10.6244 - val_loss: 172.7174 - val_root_mean_squared_error: 10.0300
Epoch 14/25
896/896 [==============================] - 3s 3ms/step - loss: 201.2133 - root_mean_squared_error: 10.4250 - val_loss: 170.5830 - val_root_mean_squared_error: 9.9632
Epoch 15/25
896/896 [==============================] - 3s 3ms/step - loss: 195.9010 - root_mean_squared_error: 10.3957 - val_loss: 185.6908 - val_root_mean_squared_error: 10.6371
Epoch 16/25
896/896 [==============================] - 3s 3ms/step - loss: 198.6955 - root_mean_squared_error: 10.3706 - val_loss: 174.6958 - val_root_mean_squared_error: 10.1349
Epoch 17/25
896/896 [==============================] - 3s 3ms/step - loss: 191.9818 - root_mean_squared_error: 10.1075 - val_loss: 168.7479 - val_root_mean_squared_error: 9.9461
Epoch 18/25
896/896 [==============================] - 3s 3ms/step - loss: 195.4126 - root_mean_squared_error: 10.3475 - val_loss: 174.7190 - val_root_mean_squared_error: 10.1293
Epoch 19/25
896/896 [==============================] - 3s 3ms/step - loss: 191.1760 - root_mean_squared_error: 10.2151 - val_loss: 196.9117 - val_root_mean_squared_error: 11.0316
Epoch 20/25
896/896 [==============================] - 3s 3ms/step - loss: 195.0695 - root_mean_squared_error: 10.2055 - val_loss: 207.0786 - val_root_mean_squared_error: 11.2562
Epoch 21/25
896/896 [==============================] - 3s 3ms/step - loss: 196.0549 - root_mean_squared_error: 10.2898 - val_loss: 216.6273 - val_root_mean_squared_error: 11.5440
Epoch 22/25
896/896 [==============================] - 3s 3ms/step - loss: 191.0560 - root_mean_squared_error: 10.1786 - val_loss: 180.4669 - val_root_mean_squared_error: 10.3446
</pre></div></div>
</div>
</section>
<section id="Saving-the-model">
<h3>Saving the model<a class="headerlink" href="#Saving-the-model" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;FC_example&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
INFO:tensorflow:Assets written to: /home/luciano/fuentes/lru_gcd/doc/examples/FC_example/assets
</pre></div></div>
</div>
<section id="Loading-the-model">
<h4>Loading the model<a class="headerlink" href="#Loading-the-model" title="Permalink to this headline"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">FCN</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;FC_example&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Learning-curves">
<h4>Learning curves<a class="headerlink" href="#Learning-curves" title="Permalink to this headline"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train loss&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation loss&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MSE&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7f9f4bbf9f70&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_75_1.png" src="../_images/examples_ExampleAircraftEngine_75_1.png" />
</div>
</div>
</section>
<section id="Prediction-on-the-training-set">
<h4>Prediction on the training set<a class="headerlink" href="#Prediction-on-the-training-set" title="Permalink to this headline"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train_batcher</span> <span class="o">=</span> <span class="n">Batcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="mi">1</span><span class="p">,</span>
                            <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">restart_at_end</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_batcher</span><span class="p">)</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">true_values</span><span class="p">(</span><span class="n">train_batcher</span><span class="o">.</span><span class="n">iterator</span><span class="p">)</span>

<span class="n">temp_result</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;FCN&#39;</span><span class="p">:[</span>
            <span class="p">{</span>
                <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true</span><span class="p">,</span>
                <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plot_true_and_predicted</span><span class="p">(</span>
    <span class="n">temp_result</span><span class="p">,</span>
    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Minutes [m]&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_77_0.png" src="../_images/examples_ExampleAircraftEngine_77_0.png" />
</div>
</div>
</section>
<section id="Prediction-on-the-validation-set">
<h4>Prediction on the validation set<a class="headerlink" href="#Prediction-on-the-validation-set" title="Permalink to this headline"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">y_pred_fcn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_batcher</span><span class="p">)</span>
<span class="n">y_true_fcn</span> <span class="o">=</span> <span class="n">true_values</span><span class="p">(</span><span class="n">val_batcher</span><span class="o">.</span><span class="n">iterator</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot_true_and_predicted</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;FCN&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_fcn</span><span class="p">,</span>
                <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_fcn</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Minutes [m]&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_79_0.png" src="../_images/examples_ExampleAircraftEngine_79_0.png" />
</div>
</div>
<p>Instead of having an array with all the predictions, another possibility to handling the predictions is using the <code class="docutils literal notranslate"><span class="pre">FittedLife</span> <span class="pre">class</span></code>. The function <code class="docutils literal notranslate"><span class="pre">split_lives</span></code> splits the whole set of predictions into a list of <code class="docutils literal notranslate"><span class="pre">FittedLife</span></code> objects. This class will also fit a picewise linear approximation of the predictions.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lives</span> <span class="o">=</span> <span class="n">split_lives</span><span class="p">(</span><span class="n">y_true_fcn</span><span class="p">,</span> <span class="n">y_pred_fcn</span><span class="p">,</span> <span class="n">RUL_threshold</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span> <span class="n">fit_line_not_increasing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lives</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;rul_pm.results.results.FittedLife at 0x7f9f3c3ed9d0&gt;,
 &lt;rul_pm.results.results.FittedLife at 0x7f9f3c3edb50&gt;,
 &lt;rul_pm.results.results.FittedLife at 0x7f9f3c3ed850&gt;]
</pre></div></div>
</div>
<p>We can plot one independent life and show also a RLS fitted from the predicted points</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">life1</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">life2</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Unit Cycles&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Unit Cycles&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:xlabel=&#39;Unit Cycles&#39;, ylabel=&#39;Unit Cycles&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_84_1.png" src="../_images/examples_ExampleAircraftEngine_84_1.png" />
</div>
</div>
<p>From each of the lives we cam compute diverse metrics: * MAE * RMSE * Unexploited lifetime [1] * Unexpected breaks [1]</p>
<p>[1] Machine Learning for Predictive Maintenance: A Multiple Classifiers Approach Susto, G. A., Schirru, A., Pampuri, S., McLoone, S., &amp; Beghi, A. (2015).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">()],</span>
    <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">()],</span>
    <span class="s1">&#39;Unexpected Break&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">()],</span>
    <span class="s1">&#39;Unexploited lifetime [m]&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">()]</span>
<span class="p">},</span>
<span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Life 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Life 2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MAE</th>
      <th>RMSE</th>
      <th>Unexpected Break</th>
      <th>Unexploited lifetime [m]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Life 1</th>
      <td>13.468262</td>
      <td>15.885864</td>
      <td>False</td>
      <td>17.85125</td>
    </tr>
    <tr>
      <th>Life 2</th>
      <td>15.393592</td>
      <td>16.968799</td>
      <td>True</td>
      <td>0.00000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
</section>
<section id="A-more-complex-model">
<h2>A more complex model<a class="headerlink" href="#A-more-complex-model" title="Permalink to this headline"></a></h2>
<p>We can use the model defined in the article “Remaining useful life estimation in prognostics using deep convolution neural networks” by Xiang Lia, Qian Ding and Jian-Qiao Sun already defined in the library.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">LearningRateScheduler</span>

<span class="kn">from</span> <span class="nn">rul_pm.models.keras.losses</span> <span class="kn">import</span> <span class="n">root_mean_squared_error</span>

<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">window</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">train_batcher</span> <span class="o">=</span> <span class="n">Batcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="n">step</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
                            <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">val_batcher</span> <span class="o">=</span> <span class="n">Batcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="n">step</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                            <span class="n">restart_at_end</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">scheduler</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">lr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Learning rate as reported in the article&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">epoch</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.001</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.0001</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">XiangQiangJianQiaoModel</span><span class="p">(</span><span class="n">n_filters</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                <span class="n">filter_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                <span class="n">dropout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                <span class="n">loss</span><span class="o">=</span><span class="n">root_mean_squared_error</span><span class="p">,</span>
                                <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_batcher</span><span class="p">,</span> <span class="n">val_batcher</span> <span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">LearningRateScheduler</span><span class="p">(</span><span class="n">scheduler</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;model&#34;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
input_1 (InputLayer)         [(None, 30, 14)]          0
_________________________________________________________________
lambda (Lambda)              (None, 30, 14, 1)         0
_________________________________________________________________
conv2d (Conv2D)              (None, 30, 14, 10)        110
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 30, 14, 10)        1010
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 30, 14, 10)        1010
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 30, 14, 10)        1010
_________________________________________________________________
conv2d_4 (Conv2D)            (None, 30, 14, 1)         31
_________________________________________________________________
flatten (Flatten)            (None, 420)               0
_________________________________________________________________
dropout (Dropout)            (None, 420)               0
_________________________________________________________________
dense (Dense)                (None, 100)               42100
_________________________________________________________________
dense_1 (Dense)              (None, 1)                 101
=================================================================
Total params: 45,372
Trainable params: 45,372
Non-trainable params: 0
_________________________________________________________________
Epoch 1/25

Epoch 00001: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 9s 56ms/step - loss: 78.9394 - root_mean_squared_error: 68.8634 - val_loss: 82.2846 - val_root_mean_squared_error: 78.1176
Epoch 2/25

Epoch 00002: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 6s 46ms/step - loss: 65.5016 - root_mean_squared_error: 54.9460 - val_loss: 70.0739 - val_root_mean_squared_error: 65.8169
Epoch 3/25

Epoch 00003: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 6s 46ms/step - loss: 55.4779 - root_mean_squared_error: 45.8200 - val_loss: 58.8821 - val_root_mean_squared_error: 54.7368
Epoch 4/25

Epoch 00004: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 7s 47ms/step - loss: 46.0068 - root_mean_squared_error: 37.0959 - val_loss: 48.4904 - val_root_mean_squared_error: 44.5328
Epoch 5/25

Epoch 00005: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 6s 46ms/step - loss: 37.7569 - root_mean_squared_error: 30.0229 - val_loss: 39.4339 - val_root_mean_squared_error: 36.2354
Epoch 6/25

Epoch 00006: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 6s 47ms/step - loss: 30.3995 - root_mean_squared_error: 24.0978 - val_loss: 31.3951 - val_root_mean_squared_error: 28.5859
Epoch 7/25

Epoch 00007: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 7s 47ms/step - loss: 24.8621 - root_mean_squared_error: 20.0647 - val_loss: 25.9471 - val_root_mean_squared_error: 23.9078
Epoch 8/25

Epoch 00008: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 6s 47ms/step - loss: 21.1103 - root_mean_squared_error: 17.4604 - val_loss: 21.2010 - val_root_mean_squared_error: 19.4003
Epoch 9/25

Epoch 00009: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 7s 47ms/step - loss: 18.0416 - root_mean_squared_error: 14.9539 - val_loss: 18.4351 - val_root_mean_squared_error: 16.7266
Epoch 10/25

Epoch 00010: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 6s 47ms/step - loss: 16.7543 - root_mean_squared_error: 13.8221 - val_loss: 17.5755 - val_root_mean_squared_error: 15.5729
Epoch 11/25

Epoch 00011: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 6s 47ms/step - loss: 16.1841 - root_mean_squared_error: 13.1060 - val_loss: 15.2355 - val_root_mean_squared_error: 13.4048
Epoch 12/25

Epoch 00012: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 7s 51ms/step - loss: 15.0168 - root_mean_squared_error: 12.0995 - val_loss: 15.1171 - val_root_mean_squared_error: 13.1466
Epoch 13/25

Epoch 00013: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 6s 46ms/step - loss: 15.2435 - root_mean_squared_error: 12.0391 - val_loss: 14.3395 - val_root_mean_squared_error: 12.1806
Epoch 14/25

Epoch 00014: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 7s 47ms/step - loss: 14.5182 - root_mean_squared_error: 11.3495 - val_loss: 13.7696 - val_root_mean_squared_error: 11.6178
Epoch 15/25

Epoch 00015: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 6s 47ms/step - loss: 14.1565 - root_mean_squared_error: 10.9881 - val_loss: 13.2545 - val_root_mean_squared_error: 10.9710
Epoch 16/25

Epoch 00016: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 6s 47ms/step - loss: 14.4116 - root_mean_squared_error: 10.9869 - val_loss: 13.6954 - val_root_mean_squared_error: 11.0839
Epoch 17/25

Epoch 00017: LearningRateScheduler reducing learning rate to 0.001.
139/139 [==============================] - 7s 47ms/step - loss: 14.0564 - root_mean_squared_error: 10.8004 - val_loss: 12.9011 - val_root_mean_squared_error: 10.3797
Epoch 18/25

Epoch 00018: LearningRateScheduler reducing learning rate to 0.0001.
139/139 [==============================] - 6s 47ms/step - loss: 13.5833 - root_mean_squared_error: 10.3266 - val_loss: 12.9021 - val_root_mean_squared_error: 10.4383
Epoch 19/25

Epoch 00019: LearningRateScheduler reducing learning rate to 0.0001.
139/139 [==============================] - 6s 47ms/step - loss: 13.4062 - root_mean_squared_error: 10.2159 - val_loss: 12.8050 - val_root_mean_squared_error: 10.3171
Epoch 20/25

Epoch 00020: LearningRateScheduler reducing learning rate to 0.0001.
139/139 [==============================] - 7s 47ms/step - loss: 13.4579 - root_mean_squared_error: 10.3146 - val_loss: 12.7679 - val_root_mean_squared_error: 10.2355
Epoch 21/25

Epoch 00021: LearningRateScheduler reducing learning rate to 0.0001.
139/139 [==============================] - 7s 48ms/step - loss: 13.3666 - root_mean_squared_error: 10.1459 - val_loss: 12.8038 - val_root_mean_squared_error: 10.3038
Epoch 22/25

Epoch 00022: LearningRateScheduler reducing learning rate to 0.0001.
139/139 [==============================] - 7s 49ms/step - loss: 13.2740 - root_mean_squared_error: 10.1362 - val_loss: 12.7188 - val_root_mean_squared_error: 10.1724
Epoch 23/25

Epoch 00023: LearningRateScheduler reducing learning rate to 0.0001.
139/139 [==============================] - 7s 49ms/step - loss: 13.3526 - root_mean_squared_error: 10.1544 - val_loss: 12.6915 - val_root_mean_squared_error: 10.1360
Epoch 24/25

Epoch 00024: LearningRateScheduler reducing learning rate to 0.0001.
139/139 [==============================] - 7s 49ms/step - loss: 13.4229 - root_mean_squared_error: 10.2283 - val_loss: 12.7357 - val_root_mean_squared_error: 10.1998
Epoch 25/25

Epoch 00025: LearningRateScheduler reducing learning rate to 0.0001.
139/139 [==============================] - 7s 47ms/step - loss: 13.4406 - root_mean_squared_error: 10.1858 - val_loss: 12.6506 - val_root_mean_squared_error: 10.0709
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train loss&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;val_loss&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validation loss&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Epoch&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MSE&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x7f9f3c3c1d60&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_89_1.png" src="../_images/examples_ExampleAircraftEngine_89_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train_batcher</span> <span class="o">=</span> <span class="n">Batcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="n">step</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_batcher</span><span class="p">)</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">true_values</span><span class="p">(</span><span class="n">train_batcher</span><span class="o">.</span><span class="n">iterator</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot_true_and_predicted</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;XiangQiangJianQiaoModel&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true</span><span class="p">,</span>
                <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Unit Cycles&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_90_0.png" src="../_images/examples_ExampleAircraftEngine_90_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">y_pred_XQJQ</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_batcher</span><span class="p">)</span>
<span class="n">y_true_XQJQ</span> <span class="o">=</span> <span class="n">true_values</span><span class="p">(</span><span class="n">val_batcher</span><span class="o">.</span><span class="n">iterator</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot_true_and_predicted</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;XiangQiangJianQiaoModel&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_XQJQ</span><span class="p">,</span>
                <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_XQJQ</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_91_0.png" src="../_images/examples_ExampleAircraftEngine_91_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lives</span> <span class="o">=</span> <span class="n">split_lives</span><span class="p">(</span><span class="n">y_true_XQJQ</span><span class="p">,</span> <span class="n">y_pred_XQJQ</span><span class="p">,</span> <span class="n">RUL_threshold</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span> <span class="n">fit_line_not_increasing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">life1</span> <span class="o">=</span> <span class="mi">82</span>
<span class="n">life2</span> <span class="o">=</span> <span class="mi">33</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[63]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:xlabel=&#39;Units Cycle&#39;, ylabel=&#39;Units Cycle&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_93_1.png" src="../_images/examples_ExampleAircraftEngine_93_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">()],</span>
    <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">()],</span>
    <span class="s1">&#39;Unexpected Break&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">()],</span>
    <span class="s1">&#39;Unexploited lifetime&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">()]</span>
<span class="p">},</span>
<span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Life 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Life 2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MAE</th>
      <th>RMSE</th>
      <th>Unexpected Break</th>
      <th>Unexploited lifetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Life 1</th>
      <td>19.920854</td>
      <td>24.402116</td>
      <td>False</td>
      <td>34.016132</td>
    </tr>
    <tr>
      <th>Life 2</th>
      <td>12.416699</td>
      <td>15.975119</td>
      <td>True</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="A-custom-model">
<h2>A custom model<a class="headerlink" href="#A-custom-model" title="Permalink to this headline"></a></h2>
<p>Also the library allows the creation of custom Keras and Pytorch models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">rul_pm.models.keras.keras</span> <span class="kn">import</span> <span class="n">KerasTrainableModel</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Input</span><span class="p">,</span> <span class="n">Conv1D</span><span class="p">,</span> <span class="n">Flatten</span><span class="p">,</span> <span class="n">Dense</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CustomModel</span><span class="p">(</span><span class="n">KerasTrainableModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">build_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_shape</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
        <span class="nb">input</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">Conv1D</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">Flatten</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="nb">input</span><span class="p">],</span> <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">window</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">train_batcher</span> <span class="o">=</span> <span class="n">Batcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="n">step</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
                            <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">val_batcher</span> <span class="o">=</span> <span class="n">Batcher</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">batch_size</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="n">step</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                            <span class="n">restart_at_end</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>


<span></span><span class="kn">from</span> <span class="nn">rul_pm.models.keras.losses</span> <span class="kn">import</span> <span class="n">root_mean_squared_error</span>





<span class="n">model</span> <span class="o">=</span> <span class="n">CustomModel</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">root_mean_squared_error</span><span class="p">,</span>
                     <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_batcher</span><span class="p">,</span> <span class="n">val_batcher</span> <span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Model: &#34;model&#34;
_________________________________________________________________
Layer (type)                 Output Shape              Param #
=================================================================
input_1 (InputLayer)         [(None, 30, 14)]          0
_________________________________________________________________
conv1d (Conv1D)              (None, 16, 10)            2110
_________________________________________________________________
flatten (Flatten)            (None, 160)               0
_________________________________________________________________
dense (Dense)                (None, 1)                 161
=================================================================
Total params: 2,271
Trainable params: 2,271
Non-trainable params: 0
_________________________________________________________________
Epoch 1/25
139/139 [==============================] - 3s 16ms/step - loss: 72.2865 - root_mean_squared_error: 63.4185 - val_loss: 23.5960 - val_root_mean_squared_error: 21.0650
Epoch 2/25
139/139 [==============================] - 1s 7ms/step - loss: 24.1797 - root_mean_squared_error: 19.4110 - val_loss: 21.4357 - val_root_mean_squared_error: 18.8928
Epoch 3/25
139/139 [==============================] - 1s 7ms/step - loss: 23.1139 - root_mean_squared_error: 18.6124 - val_loss: 19.8082 - val_root_mean_squared_error: 17.2665
Epoch 4/25
139/139 [==============================] - 1s 7ms/step - loss: 20.9396 - root_mean_squared_error: 16.8404 - val_loss: 18.2937 - val_root_mean_squared_error: 15.8281
Epoch 5/25
139/139 [==============================] - 1s 7ms/step - loss: 20.0481 - root_mean_squared_error: 16.1308 - val_loss: 17.5807 - val_root_mean_squared_error: 15.1553
Epoch 6/25
139/139 [==============================] - 1s 7ms/step - loss: 19.0448 - root_mean_squared_error: 15.3330 - val_loss: 16.8012 - val_root_mean_squared_error: 14.3068
Epoch 7/25
139/139 [==============================] - 1s 7ms/step - loss: 18.0985 - root_mean_squared_error: 14.4993 - val_loss: 16.4220 - val_root_mean_squared_error: 13.9826
Epoch 8/25
139/139 [==============================] - 1s 7ms/step - loss: 17.1978 - root_mean_squared_error: 13.7745 - val_loss: 16.2248 - val_root_mean_squared_error: 13.7929
Epoch 9/25
139/139 [==============================] - 1s 7ms/step - loss: 16.2736 - root_mean_squared_error: 13.0397 - val_loss: 15.4584 - val_root_mean_squared_error: 12.9977
Epoch 10/25
139/139 [==============================] - 1s 7ms/step - loss: 15.9157 - root_mean_squared_error: 12.7483 - val_loss: 15.3800 - val_root_mean_squared_error: 12.8981
Epoch 11/25
139/139 [==============================] - 1s 7ms/step - loss: 15.7811 - root_mean_squared_error: 12.6435 - val_loss: 15.2305 - val_root_mean_squared_error: 12.7011
Epoch 12/25
139/139 [==============================] - 1s 7ms/step - loss: 15.5742 - root_mean_squared_error: 12.4757 - val_loss: 15.1563 - val_root_mean_squared_error: 12.6375
Epoch 13/25
139/139 [==============================] - 1s 7ms/step - loss: 15.4686 - root_mean_squared_error: 12.3857 - val_loss: 15.2845 - val_root_mean_squared_error: 12.7706
Epoch 14/25
139/139 [==============================] - 1s 7ms/step - loss: 15.2015 - root_mean_squared_error: 12.1355 - val_loss: 14.7915 - val_root_mean_squared_error: 12.3133
Epoch 15/25
139/139 [==============================] - 1s 7ms/step - loss: 15.1651 - root_mean_squared_error: 12.1822 - val_loss: 14.7872 - val_root_mean_squared_error: 12.2789
Epoch 16/25
139/139 [==============================] - 1s 7ms/step - loss: 15.0856 - root_mean_squared_error: 12.1093 - val_loss: 14.6932 - val_root_mean_squared_error: 12.2276
Epoch 17/25
139/139 [==============================] - 1s 7ms/step - loss: 15.1247 - root_mean_squared_error: 12.1358 - val_loss: 14.6534 - val_root_mean_squared_error: 12.1825
Epoch 18/25
139/139 [==============================] - 1s 8ms/step - loss: 14.9101 - root_mean_squared_error: 11.9299 - val_loss: 14.9543 - val_root_mean_squared_error: 12.4746
Epoch 19/25
139/139 [==============================] - 1s 8ms/step - loss: 14.8666 - root_mean_squared_error: 11.9006 - val_loss: 14.5241 - val_root_mean_squared_error: 12.0616
Epoch 20/25
139/139 [==============================] - 1s 7ms/step - loss: 14.7606 - root_mean_squared_error: 11.8013 - val_loss: 15.1241 - val_root_mean_squared_error: 12.6682
Epoch 21/25
139/139 [==============================] - 1s 7ms/step - loss: 14.8367 - root_mean_squared_error: 11.8893 - val_loss: 15.1062 - val_root_mean_squared_error: 12.6481
Epoch 22/25
139/139 [==============================] - 1s 7ms/step - loss: 14.9608 - root_mean_squared_error: 11.9358 - val_loss: 14.6641 - val_root_mean_squared_error: 12.1901
Epoch 23/25
139/139 [==============================] - 1s 7ms/step - loss: 14.8255 - root_mean_squared_error: 11.8735 - val_loss: 14.6877 - val_root_mean_squared_error: 12.2152
Epoch 24/25
139/139 [==============================] - 1s 7ms/step - loss: 14.8246 - root_mean_squared_error: 11.8736 - val_loss: 14.7451 - val_root_mean_squared_error: 12.2915
Epoch 25/25
139/139 [==============================] - 1s 7ms/step - loss: 14.6580 - root_mean_squared_error: 11.7053 - val_loss: 14.4394 - val_root_mean_squared_error: 11.9800
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">y_pred_custom</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_batcher</span><span class="p">)</span>
<span class="n">y_true_custom</span> <span class="o">=</span> <span class="n">true_values</span><span class="p">(</span><span class="n">val_batcher</span><span class="o">.</span><span class="n">iterator</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plot_true_and_predicted</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;CustomModel&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true</span><span class="p">,</span>
                <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_99_0.png" src="../_images/examples_ExampleAircraftEngine_99_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">lives</span> <span class="o">=</span> <span class="n">split_lives</span><span class="p">(</span><span class="n">y_true_custom</span><span class="p">,</span> <span class="n">y_pred_custom</span><span class="p">,</span> <span class="n">RUL_threshold</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span> <span class="n">fit_line_not_increasing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">life1</span> <span class="o">=</span> <span class="mi">82</span>
<span class="n">life2</span> <span class="o">=</span> <span class="mi">33</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">()],</span>
    <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">()],</span>
    <span class="s1">&#39;Unexpected Break&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">()],</span>
    <span class="s1">&#39;Unexploited lifetime&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">()]</span>
<span class="p">},</span>
<span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Life 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Life 2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[73]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MAE</th>
      <th>RMSE</th>
      <th>Unexpected Break</th>
      <th>Unexploited lifetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Life 1</th>
      <td>25.282678</td>
      <td>27.670572</td>
      <td>False</td>
      <td>26.437256</td>
    </tr>
    <tr>
      <th>Life 2</th>
      <td>13.020645</td>
      <td>14.412559</td>
      <td>True</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_100_1.png" src="../_images/examples_ExampleAircraftEngine_100_1.png" />
</div>
</div>
<section id="Scikit-learn-and-gradient-boosting-models">
<h3>Scikit-learn and gradient boosting models<a class="headerlink" href="#Scikit-learn-and-gradient-boosting-models" title="Permalink to this headline"></a></h3>
<p>Following the same API we can create scikit-learn and XGBoost models for regressing our data.</p>
<p>In the following example we are going to create a RandomForestRegressor to predict the RUL of the same dataset</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>



<span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">window</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">train_iterator</span> <span class="o">=</span> <span class="n">WindowedDatasetIterator</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="n">step</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
                            <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">val_iterator</span> <span class="o">=</span> <span class="n">WindowedDatasetIterator</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span>
                            <span class="n">window</span><span class="p">,</span>
                            <span class="n">functional_transformer</span><span class="p">,</span>
                            <span class="n">step</span><span class="p">,</span>
                            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">cache_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">SKLearnModel</span><span class="p">(</span><span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_iterator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[74]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;rul_pm.models.sklearn.SKLearnModel at 0x7f9f3c2660a0&gt;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[75]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_pred_rf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_iterator</span><span class="p">)</span>
<span class="n">y_true_rf</span> <span class="o">=</span> <span class="n">true_values</span><span class="p">(</span><span class="n">val_iterator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_true_and_predicted</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;RandomForest&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_rf</span><span class="p">,</span>
                <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_rf</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">);</span>
<span class="n">lives</span> <span class="o">=</span> <span class="n">split_lives</span><span class="p">(</span><span class="n">y_true_rf</span><span class="p">,</span> <span class="n">y_pred_rf</span><span class="p">,</span> <span class="n">RUL_threshold</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span> <span class="n">fit_line_not_increasing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">life1</span> <span class="o">=</span> <span class="mi">82</span>
<span class="n">life2</span> <span class="o">=</span> <span class="mi">33</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">()],</span>
    <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">()],</span>
    <span class="s1">&#39;Unexpected Break&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">()],</span>
    <span class="s1">&#39;Unexploited lifetime&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">()]</span>
<span class="p">},</span>
<span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Life 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Life 2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MAE</th>
      <th>RMSE</th>
      <th>Unexpected Break</th>
      <th>Unexploited lifetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Life 1</th>
      <td>34.644439</td>
      <td>36.862445</td>
      <td>False</td>
      <td>40.34</td>
    </tr>
    <tr>
      <th>Life 2</th>
      <td>10.021458</td>
      <td>12.246251</td>
      <td>True</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_105_1.png" src="../_images/examples_ExampleAircraftEngine_105_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_105_2.png" src="../_images/examples_ExampleAircraftEngine_105_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">rul_pm.models.gradientboosting</span> <span class="kn">import</span> <span class="n">XGBoostModel</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">XGBoostModel</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_iterator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;rul_pm.models.gradientboosting.XGBoostModel at 0x7f9f3c33c460&gt;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[78]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_pred_gb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">val_iterator</span><span class="p">)</span>
<span class="n">y_true_gb</span> <span class="o">=</span> <span class="n">true_values</span><span class="p">(</span><span class="n">val_iterator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_true_and_predicted</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s1">&#39;Gradient Boosting&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_gb</span><span class="p">,</span>
                <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_gb</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">3500</span><span class="p">);</span>
<span class="n">lives</span> <span class="o">=</span> <span class="n">split_lives</span><span class="p">(</span><span class="n">y_true_gb</span><span class="p">,</span> <span class="n">y_pred_gb</span><span class="p">,</span> <span class="n">RUL_threshold</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span> <span class="n">fit_line_not_increasing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">life1</span> <span class="o">=</span> <span class="mi">82</span>
<span class="n">life2</span> <span class="o">=</span> <span class="mi">33</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">()],</span>
    <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">()],</span>
    <span class="s1">&#39;Unexpected Break&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">()],</span>
    <span class="s1">&#39;Unexploited lifetime&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">()]</span>
<span class="p">},</span>
<span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Life 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Life 2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[79]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MAE</th>
      <th>RMSE</th>
      <th>Unexpected Break</th>
      <th>Unexploited lifetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Life 1</th>
      <td>26.788751</td>
      <td>31.534081</td>
      <td>False</td>
      <td>45.116096</td>
    </tr>
    <tr>
      <th>Life 2</th>
      <td>15.216826</td>
      <td>18.304058</td>
      <td>True</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_109_1.png" src="../_images/examples_ExampleAircraftEngine_109_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_109_2.png" src="../_images/examples_ExampleAircraftEngine_109_2.png" />
</div>
</div>
</section>
</section>
<section id="Model-comparison-and-evaluation">
<h2>Model comparison and evaluation<a class="headerlink" href="#Model-comparison-and-evaluation" title="Permalink to this headline"></a></h2>
<p>One of the most important issues regarding PM is the ability to compare and evaluate different methods.</p>
<p>The main data structure used in the results module is a dictionary in which each of the keys is the model name, and the elements are a list of dictionaries. Each of the dictionaries contains two keys: true, predicted. Each element of the model array is interpreted as a Fold in CV settings. If the array contains only one element it can be considered that the evaluation has been made on a hold-out set.</p>
<p>For this poropouse there are function for visualizing the results on a hold-out set:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">hold_out_barplot_errors_wrt_RUL_multiple_models</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hold_out_boxplot_errors_wrt_RUL_multiple_models</span></code></p></li>
</ul>
<p>And for visualizing the reults on a cross validated predictions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cv_barplot_errors_wrt_RUL_multiple_models</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cv_boxplot_errors_wrt_RUL_multiple_models</span></code></p></li>
</ul>
<p>This in an example of the dictionary structure</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;Model Name&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">true_0</span><span class="p">,</span> <span class="n">true_1</span><span class="p">,</span><span class="o">....</span><span class="p">,</span> <span class="n">true_n</span><span class="p">],</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">pred_0</span><span class="p">,</span> <span class="n">pred_1</span><span class="p">,</span><span class="o">....</span><span class="p">,</span> <span class="n">pred_n</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">true_0</span><span class="p">,</span> <span class="n">true_1</span><span class="p">,</span><span class="o">....</span><span class="p">,</span> <span class="n">true_m</span><span class="p">],</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">pred_0</span><span class="p">,</span> <span class="n">pred_1</span><span class="p">,</span><span class="o">....</span><span class="p">,</span> <span class="n">pred_m</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="o">...</span>
    <span class="s1">&#39;Model Name 2&#39;</span><span class="p">:</span> <span class="p">[</span>
         <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">true_0</span><span class="p">,</span> <span class="n">true_1</span><span class="p">,</span><span class="o">....</span><span class="p">,</span> <span class="n">true_n</span><span class="p">],</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">pred_0</span><span class="p">,</span> <span class="n">pred_1</span><span class="p">,</span><span class="o">....</span><span class="p">,</span> <span class="n">pred_n</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">true_0</span><span class="p">,</span> <span class="n">true_1</span><span class="p">,</span><span class="o">....</span><span class="p">,</span> <span class="n">true_m</span><span class="p">],</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">pred_0</span><span class="p">,</span> <span class="n">pred_1</span><span class="p">,</span><span class="o">....</span><span class="p">,</span> <span class="n">pred_m</span><span class="p">]</span>
        <span class="p">},</span>
        <span class="o">...</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first step is to construct our data structure. Since we evaluated in a hold-out set, each list of each model will contain only one element.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[112]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;FCN&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_fcn</span><span class="p">,</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_fcn</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s1">&#39;XiangQiangJianQiao&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_XQJQ</span><span class="p">,</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_XQJQ</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s1">&#39;Custom&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_custom</span><span class="p">,</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_custom</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s1">&#39;Gradient Boosting&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_gb</span><span class="p">,</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_gb</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s1">&#39;Random forest&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_rf</span><span class="p">,</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_rf</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<section id="Bar-Plot">
<h3>Bar Plot<a class="headerlink" href="#Bar-Plot" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[113]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hold_out_barplot_errors_wrt_RUL_multiple_models</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="s1">&#39; Cycle Units&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_115_0.png" src="../_images/examples_ExampleAircraftEngine_115_0.png" />
</div>
</div>
</section>
<section id="Box-Plot">
<h3>Box Plot<a class="headerlink" href="#Box-Plot" title="Permalink to this headline"></a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[114]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hold_out_boxplot_errors_wrt_RUL_multiple_models</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="s1">&#39; Cycle Units&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_117_0.png" src="../_images/examples_ExampleAircraftEngine_117_0.png" />
</div>
</div>
<p>Additionally to the regression error, it is possible to compute some metrics more easily interpretable. In this context, two metrics were defined in [1], namely:</p>
<ul class="simple">
<li><p>Frequency of Unexpected Breaks (ρUB) - the percentage of failures not prevented;</p></li>
<li><p>Amount of Unexploited Lifetime (ρUL) - the average number of time that could have been run before failure if the preventative maintenance suggested by the maintenance management mod-ule had not been performed.</p></li>
</ul>
<p>A comparison between the predicted end of life with respect to the true end of that particular life is made.</p>
<div class="line-block">
<div class="line">In that case, three scenarios can happen: - The predicted end of life occurs before the true one. In that case, the predictions were pessimistic and the tool could have been used more time. - The remaining useful life arrives at zero after the true remaining useful life. In that case, we incur the risk of the tool breaking.</div>
<div class="line">- The predicted line coincides with the true line. In that case, we don’t have unexploited time, and the risk of breakage can be considered 0.</div>
</div>
<p>Since usually the breakages are considered more harmful, a possible approach to preventing unexpected failures is to consider a more conservative maintenance approach, providing maintenance tasks recommendations some time before the end of life predicted. In that way, a conservative window can be defined in which the recommendation of making maintenance task should be performed at time T-predicted - conservative window size.</p>
<p>It is possible to visualize how it grows the unexploited lifetime grows as the conservative window size grows and how the unexpected breaks decrease as the conservative window size grows.</p>
<p>[1] Machine Learning for Predictive Maintenance: A Multiple Classifiers Approach Susto, G. A., Schirru, A., Pampuri, S., McLoone, S., &amp; Beghi, A. (2015).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_unexploited_lifetime</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">max_window</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39; [Cycle units]&#39;</span><span class="p">)</span>
<span class="n">plot_unexpected_breaks</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">max_window</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39; [Cycle units]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:title={&#39;center&#39;:&#39;Unexpected breaks&#39;}, xlabel=&#39;Fault window size [Cycle units]&#39;, ylabel=&#39;Risk of breakage&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_119_1.png" src="../_images/examples_ExampleAircraftEngine_119_1.png" />
</div>
</div>
</section>
<section id="Comparison-with-baseline-models">
<h3>Comparison with baseline models<a class="headerlink" href="#Comparison-with-baseline-models" title="Permalink to this headline"></a></h3>
<p>Another important issue to consider when comparing models is to evaluate the models with respect to preventive maintenance approaches. RUL-PM provides <code class="docutils literal notranslate"><span class="pre">BaselineModel</span></code> that computes the mean and the median duration from the true targets of the data. <code class="docutils literal notranslate"><span class="pre">BaselineModel</span></code> uses a <code class="docutils literal notranslate"><span class="pre">LifeDatasetIterator</span></code>, that as its names indicate, iterate over each life, transforming it.</p>
<section id="Baseline-models-creation">
<h4>Baseline models creation<a class="headerlink" href="#Baseline-models-creation" title="Permalink to this headline"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[92]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mean_baseline_model</span> <span class="o">=</span> <span class="n">BaselineModel</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">RUL_threshold</span><span class="o">=</span><span class="mi">125</span><span class="p">)</span>
<span class="n">median_baseline_model</span> <span class="o">=</span> <span class="n">BaselineModel</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="n">RUL_threshold</span><span class="o">=</span><span class="mi">125</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Fitting-baseline-models">
<h4>Fitting baseline models<a class="headerlink" href="#Fitting-baseline-models" title="Permalink to this headline"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[126]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">life_iterator</span> <span class="o">=</span> <span class="n">LifeDatasetIterator</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">functional_transformer</span><span class="p">)</span>

<span class="n">mean_baseline_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">life_iterator</span><span class="p">)</span>
<span class="n">median_baseline_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">life_iterator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[127]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">life_iterator</span> <span class="o">=</span> <span class="n">LifeDatasetIterator</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span> <span class="n">functional_transformer</span><span class="p">)</span>
<span class="n">y_pred_mean</span> <span class="o">=</span> <span class="n">mean_baseline_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">life_iterator</span><span class="p">)</span>
<span class="n">y_true_mean</span> <span class="o">=</span> <span class="n">true_values</span><span class="p">(</span><span class="n">life_iterator</span><span class="p">)</span>


<span class="n">y_pred_median</span> <span class="o">=</span> <span class="n">median_baseline_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">life_iterator</span><span class="p">)</span>
<span class="n">y_true_median</span> <span class="o">=</span> <span class="n">true_values</span><span class="p">(</span><span class="n">life_iterator</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[128]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results_baseline</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Mean baseline&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_mean</span><span class="p">,</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_mean</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s1">&#39;Median baseline&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s1">&#39;true&#39;</span><span class="p">:</span> <span class="n">y_true_median</span><span class="p">,</span>
            <span class="s1">&#39;predicted&#39;</span><span class="p">:</span> <span class="n">y_pred_median</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[129]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">plot_true_and_predicted</span><span class="p">(</span>
    <span class="n">results_baseline</span><span class="p">,</span>
    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3500</span><span class="p">);</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_127_0.png" src="../_images/examples_ExampleAircraftEngine_127_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[130]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">lives</span> <span class="o">=</span> <span class="n">split_lives</span><span class="p">(</span><span class="n">y_true_median</span><span class="p">,</span> <span class="n">y_pred_median</span><span class="p">,</span> <span class="n">RUL_threshold</span><span class="o">=</span><span class="mi">125</span><span class="p">)</span>
<span class="n">life1</span> <span class="o">=</span> <span class="mi">82</span>
<span class="n">life2</span> <span class="o">=</span> <span class="mi">33</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plot_life</span><span class="p">(</span><span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;Units Cycle&#39;</span><span class="p">,</span> <span class="n">add_fitted</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;MAE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">mae</span><span class="p">()],</span>
    <span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">rmse</span><span class="p">()],</span>
    <span class="s1">&#39;Unexpected Break&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexpected_break</span><span class="p">()],</span>
    <span class="s1">&#39;Unexploited lifetime&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">lives</span><span class="p">[</span><span class="n">life1</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">(),</span> <span class="n">lives</span><span class="p">[</span><span class="n">life2</span><span class="p">]</span><span class="o">.</span><span class="n">unexploited_lifetime</span><span class="p">()]</span>
<span class="p">},</span>
<span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Life 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Life 2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[130]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>MAE</th>
      <th>RMSE</th>
      <th>Unexpected Break</th>
      <th>Unexploited lifetime</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Life 1</th>
      <td>36.644295</td>
      <td>38.675209</td>
      <td>True</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>Life 2</th>
      <td>19.477157</td>
      <td>27.340957</td>
      <td>False</td>
      <td>9.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_128_1.png" src="../_images/examples_ExampleAircraftEngine_128_1.png" />
</div>
</div>
</section>
</section>
<section id="Comparison-with-the-full-set-of-models">
<h3>Comparison with the full set of models<a class="headerlink" href="#Comparison-with-the-full-set-of-models" title="Permalink to this headline"></a></h3>
<section id="Regression-metrics">
<h4>Regression metrics<a class="headerlink" href="#Regression-metrics" title="Permalink to this headline"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[147]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cv_regression_metrics</span><span class="p">(</span><span class="n">results</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">[[</span><span class="s1">&#39;mean&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[147]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>FCN</th>
      <td>10.344598</td>
    </tr>
    <tr>
      <th>XiangQiangJianQiao</th>
      <td>10.070873</td>
    </tr>
    <tr>
      <th>Custom</th>
      <td>11.980034</td>
    </tr>
    <tr>
      <th>Gradient Boosting</th>
      <td>12.825324</td>
    </tr>
    <tr>
      <th>Random forest</th>
      <td>13.698453</td>
    </tr>
    <tr>
      <th>Mean baseline</th>
      <td>41.795912</td>
    </tr>
    <tr>
      <th>Median baseline</th>
      <td>38.356063</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Maintenance-metrics">
<h4>Maintenance metrics<a class="headerlink" href="#Maintenance-metrics" title="Permalink to this headline"></a></h4>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[149]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">results_baseline</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plot_unexploited_lifetime</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">max_window</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39; [Cycle units]&#39;</span><span class="p">)</span>
<span class="n">plot_unexpected_breaks</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">max_window</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39; [Cycle units]&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_ExampleAircraftEngine_133_0.png" src="../_images/examples_ExampleAircraftEngine_133_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../reference/feature_transformation/target.html" class="btn btn-neutral float-left" title="Target transformation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>